<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.111.3"><title>How to pass data to PyTest fixtures from the CLI | Jordi Smit</title><meta name=description content="Today I learned how to pass different URLs via the CLI to PyTest fixtures to make my test reusable on different API deployments."><meta name=keywords content="python,pytest,testing"><link rel=canonical href=https://jordismit.com/til/how-to-pass-data-to-pytest-fixtures-from-the-cli/><meta property="og:type" content="website"><meta property="og:title" content="How to pass data to PyTest fixtures from the CLI | Jordi Smit"><meta property="og:description" content="Today I learned how to pass different URLs via the CLI to PyTest fixtures to make my test reusable on different API deployments."><meta property="og:site_name" content="Jordi Smit"><meta property="og:url" content="https://jordismit.com/til/how-to-pass-data-to-pytest-fixtures-from-the-cli/"><meta property="og:locale" content="en"><meta property="og:image" content="https://jordismit.com/til/how-to-pass-data-to-pytest-fixtures-from-the-cli/images/cover.jpg"><meta property="og:image:secure_url" content="https://jordismit.com/til/how-to-pass-data-to-pytest-fixtures-from-the-cli/images/cover.jpg"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to pass data to PyTest fixtures from the CLI"><meta name=twitter:description content="Today I learned how to pass different URLs via the CLI to PyTest fixtures to make my test reusable on different API deployments."><link rel=stylesheet href=https://jordismit.com/css/bootstrap.min.60b19e5da6a9234ff9220668a5ec1125c157a268513256188ee80f2d2c8d8d36.css integrity="sha256-YLGeXaapI0/5IgZopewRJcFXomhRMlYYjugPLSyNjTY="><link rel=stylesheet href=https://jordismit.com/css/goolge-fonts.min.59f98c25da594b2a690835ae556add4bd6b87b555c2be822e4f8d7ed2ac28c55.css integrity="sha256-WfmMJdpZSyppCDWuVWrdS9a4e1VcK+gi5PjX7SrCjFU="><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link rel=stylesheet href=https://jordismit.com/css/medium.min.e66d0e4ae688e3a5810c787217a0415a08000e0855cdfdd538f874f3b5a3273f.css integrity="sha256-5m0OSuaI46WBDHhyF6BBWggADghVzf3VOPh087WjJz8="><link rel=stylesheet href=https://jordismit.com/css/additional.min.367d6ec3565355818ede31d5db72442ef6ae21568fc7bd015286acecabe11257.css integrity="sha256-Nn1uw1ZTVYGO3jHV23JELvauIVaPx70BUoas7KvhElc="><link rel=icon type=image/x-icon href=https://jordismit.com/favicon/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=https://jordismit.com/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://jordismit.com/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://jordismit.com/favicon/favicon-16x16.png><meta name=theme-color content="#fff"></head><body class="d-flex flex-column min-vh-100"><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=https://jordismit.com/><span style=font-family:Righteous>Jordi Smit</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/blog>Blog</a></li><li class=nav-item><a class=nav-link href=/til>TIL</a></li><li class=nav-item><a class=nav-link href=/cheat-sheets>Cheat-sheets</a></li><li class=nav-item><a class=nav-link href=/about>About Me</a></li></ul></div></div></nav><div class=site-content><div class=container><div class=main-content><div class=container><div class=row><div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset"><p>Share</p><ul><li class="ml-1 mr-1"><a target=_blank href="https://twitter.com/intent/tweet?text=How%20to%20pass%20data%20to%20PyTest%20fixtures%20from%20the%20CLI&url=https%3a%2f%2fjordismit.com%2ftil%2fhow-to-pass-data-to-pytest-fixtures-from-the-cli%2f" onclick='return window.open(this.href,"twitter-share","width=550,height=435"),!1'><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://facebook.com/sharer.php?u=https%3a%2f%2fjordismit.com%2ftil%2fhow-to-pass-data-to-pytest-fixtures-from-the-cli%2f" onclick='return window.open(this.href,"facebook-share","width=550,height=435"),!1'><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fjordismit.com%2ftil%2fhow-to-pass-data-to-pytest-fixtures-from-the-cli%2f" onclick='return window.open(this.href,"linkedin-share","width=550,height=435"),!1'><i class="fab fa-linkedin"></i></a></li></ul></div></div><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><div class="row post-top-meta"><div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right"><a href=/about><img class=author-thumb src=https://jordismit.com/media/images/author_hu25d333fcded103db2f52f7476cb1420a_204682_250x0_resize_q75_box.jpg alt=Author></a></div><div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left"><a href=/about class=link-dark>Jordi
Smit</a><br><span class=author-description>Machine Learning Engineer<br>Jun 29, 2022
<i class="far fa-clock clock"></i>
2 min read</span></div></div><h1 class=posttitle>How to pass data to PyTest fixtures from the CLI</h1></div><div class=post-featured-image><img class=img-fluid src=https://jordismit.com/til/how-to-pass-data-to-pytest-fixtures-from-the-cli/images/cover.jpg alt="thumbnail for this post"></div><div class=article-post><p>A short while ago, I needed to create some high-level smoke tests that tested whether an API I deployed was working as intended.
The test cases were relatively straightforward to write.
However, the tricky part was that I wanted to use these test cases for both my stage and production deployment, which of course, have different URLs.
At first, I was trying to solve the problem by passing the deployment URL via environment variables.
Although this worked, it didn&rsquo;t feel like the right solution since it felt rather complicated, and it didn&rsquo;t work nicely in scenarios where someone forgot to set the environment variables.</p><p>So I went searching for a better solution. Eventually, I found a solution that allows me to pass the URL parameter using the following command: <code>pytest --url SOME_VALUE</code>.
It works using the following code:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Optional
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pytest_addoption</span>(parser):
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>addoption(<span style=color:#e6db74>&#34;--url&#34;</span>, action<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;store&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@pytest.fixture</span>(scope<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;session&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>url</span>(request: pytest<span style=color:#f92672>.</span>FixtureRequest) <span style=color:#f92672>-&gt;</span> Optional[str]:
</span></span><span style=display:flex><span>    url_value <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>option<span style=color:#f92672>.</span>url
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> url_value <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        pytest<span style=color:#f92672>.</span>skip()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> url_value
</span></span></code></pre></td></tr></table></div></div><p>In this code snippet, I used the <code>pytest_addoption</code> function in the top-level <code>conftest.py</code> file to add the <code>--url</code> parameter to the <code>pytest</code> CLI.
Now, the optional value of the url parameter becomes available in the <code>pytest.FixtureRequest</code> config options, which means we can expose it as a PyTest fixture.</p><p>What I really like about this solution is that works with both the <code>pytest --url SOME_URL</code> and <code>pytest</code> command.
This works because if the <code>url</code> parameter is not defined, all test cases that depend on the <code>url</code> fixture will be skipped due to the <code>pytest.skip()</code>.</p></div><div class=after-post-tags><ul class=tags><li><a href=/tags/python>python</a></li><li><a href=/tags/pytest>pytest</a></li><li><a href=/tags/testing>testing</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="d-block col-md-6" href=https://jordismit.com/til/how-to-find-the-last-record-in-a-group-using-kql/>&#171; How to Find the Last Record in a Group Using KQL</a><div class=clearfix></div></div></div></div></div></div></div></div><footer class="footer mt-auto"><div class=container><div class=row><div class="col-md-12 col-sm-612 text-center">&copy; Copyright
Jordi Smit - All rights reserved</div></div></div></footer><script async src=https://jordismit.com/js/mediumish.min.9d9d966a5fcd9fe6f66e99d7d39ffd341eedde773a8b096c898da98e0560da7d.js integrity="sha256-nZ2Wal/Nn+b2bpnX05/9NB7t3nc6iwlsiY2pjgVg2n0="></script></body></html>