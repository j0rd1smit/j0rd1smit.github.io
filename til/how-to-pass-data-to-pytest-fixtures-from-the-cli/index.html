<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><title>How to pass data to PyTest fixtures from the CLI | J0rd1Smit</title><meta name=twitter:card content="summary"><meta name=twitter:title content="How to pass data to PyTest fixtures from the CLI"><meta name=twitter:description content="A short while ago, I needed to create some high-level smoke tests that tested whether an API I deployed was working as intended."><meta property="og:title" content="How to pass data to PyTest fixtures from the CLI"><meta property="og:description" content="A short while ago, I needed to create some high-level smoke tests that tested whether an API I deployed was working as intended."><meta property="og:type" content="article"><meta property="og:url" content="https://j0rd1smit.github.io/til/how-to-pass-data-to-pytest-fixtures-from-the-cli/"><meta property="article:section" content="til"><meta property="article:published_time" content="2022-06-29T21:45:20+02:00"><meta property="article:modified_time" content="2022-06-29T21:45:20+02:00"><link rel=stylesheet href=https://j0rd1smit.github.io/css/bootstrap.min.60b19e5da6a9234ff9220668a5ec1125c157a268513256188ee80f2d2c8d8d36.css integrity="sha256-YLGeXaapI0/5IgZopewRJcFXomhRMlYYjugPLSyNjTY="><link rel=stylesheet href=https://j0rd1smit.github.io/css/goolge-fonts.b251d02039bb76d3217f1bec88330f4bc1721d311854924a7217dcffe5bc80cb.css integrity="sha256-slHQIDm7dtMhfxvsiDMPS8FyHTEYVJJKchfc/+W8gMs="><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link rel=stylesheet href=https://j0rd1smit.github.io/css/medium.f36718093dde5221018913624ac66c2830981a38acedac9111e4ccd2c5693779.css integrity="sha256-82cYCT3eUiEBiRNiSsZsKDCYGjis7ayREeTM0sVpN3k="><link rel=stylesheet href=https://j0rd1smit.github.io/css/additional.4ef3d39c77b4a1adf1b5b6998bc22aa9fe2465cbbfbfdc12c2b7aa07dc13dd9d.css integrity="sha256-TvPTnHe0oa3xtbaZi8Iqqf4kZcu/v9wSwreqB9wT3Z0="></head><body class="d-flex flex-column min-vh-100"><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=https://j0rd1smit.github.io/><span style=font-family:Righteous>J0rd1Smit</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/blog>Blog</a></li><li class=nav-item><a class=nav-link href=/til>TIL</a></li><li class=nav-item><a class=nav-link href=/about>About Me</a></li></ul></div></div></nav><div class=site-content><div class=container><div class=mainheading><h1 class=sitetitle>J0rd1Smit</h1><p class=lead></p></div><div class=main-content><div class=container><div class=row><div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset"><p>Share</p><ul><li class="ml-1 mr-1"><a target=_blank href="https://twitter.com/intent/tweet?text=How%20to%20pass%20data%20to%20PyTest%20fixtures%20from%20the%20CLI&url=https%3a%2f%2fj0rd1smit.github.io%2ftil%2fhow-to-pass-data-to-pytest-fixtures-from-the-cli%2f" onclick='return window.open(this.href,"twitter-share","width=550,height=435"),!1'><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://facebook.com/sharer.php?u=https%3a%2f%2fj0rd1smit.github.io%2ftil%2fhow-to-pass-data-to-pytest-fixtures-from-the-cli%2f" onclick='return window.open(this.href,"facebook-share","width=550,height=435"),!1'><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fj0rd1smit.github.io%2ftil%2fhow-to-pass-data-to-pytest-fixtures-from-the-cli%2f" onclick='return window.open(this.href,"linkedin-share","width=550,height=435"),!1'><i class="fab fa-linkedin"></i></a></li></ul></div></div><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><div class="row post-top-meta"><div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right"><a href=/about><img class=author-thumb src=https://j0rd1smit.github.io/media/images/author_hu25d333fcded103db2f52f7476cb1420a_204682_250x0_resize_q75_box.jpg alt=Author></a></div><div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left"><a href=/about class=link-dark>Jordi
Smit</a><br><span class=author-description>Machine Learning Engineer<br>Jun 29, 2022
<i class="far fa-clock clock"></i>
2 min read</span></div></div><h1 class=posttitle>How to pass data to PyTest fixtures from the CLI</h1></div><img class="featured-image img-fluid" src=https://j0rd1smit.github.io/til/how-to-pass-data-to-pytest-fixtures-from-the-cli/images/cover_hu700675a3593f2196f90a24bec185a055_72320_800x0_resize_q75_box.jpg alt="thumbnail for this post"><div class=article-post><p>A short while ago, I needed to create some high-level smoke tests that tested whether an API I deployed was working as intended.
The test cases were relatively straightforward to write.
However, the tricky part was that I wanted to use these test cases for both my stage and production deployment, which of course, have different URLs.
At first, I was trying to solve the problem by passing the deployment URL via environment variables.
Although this worked, it didn&rsquo;t feel like the right solution since it felt rather complicated, and it didn&rsquo;t work nicely in scenarios where someone forgot to set the environment variables.</p><p>So I went searching for a better solution. Eventually, I found a solution that allows me to pass the URL parameter using the following command: <code>pytest --url SOME_VALUE</code>.
It works using the following code:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Optional
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pytest_addoption</span>(parser):
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>addoption(<span style=color:#e6db74>&#34;--url&#34;</span>, action<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;store&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@pytest</span><span style=color:#f92672>.</span>fixture(scope<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;session&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>url</span>(request: pytest<span style=color:#f92672>.</span>FixtureRequest) <span style=color:#f92672>-&gt;</span> Optional[str]:
</span></span><span style=display:flex><span>    url_value <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>option<span style=color:#f92672>.</span>url
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> url_value <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        pytest<span style=color:#f92672>.</span>skip()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> url_value
</span></span></code></pre></td></tr></table></div></div><p>In this code snippet, I used the <code>pytest_addoption</code> function in the top-level <code>conftest.py</code> file to add the <code>--url</code> parameter to the <code>pytest</code> CLI.
Now, the optional value of the url parameter becomes available in the <code>pytest.FixtureRequest</code> config options, which means we can expose it as a PyTest fixture.</p><p>What I really like about this solution is that works with both the <code>pytest --url SOME_URL</code> and <code>pytest</code> command.
This works because if the <code>url</code> parameter is not defined, all test cases that depend on the <code>url</code> fixture will be skipped due to the <code>pytest.skip()</code>.</p></div><div class=after-post-tags><ul class=tags></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><div class=clearfix></div></div></div></div></div></div></div></div><footer class="footer mt-auto"><div class=container><div class=row><div class="col-md-12 col-sm-612 text-center">&copy; Copyright
Jordi Smit - All rights reserved</div></div></div></footer><script src=https://j0rd1smit.github.io/js/jquery-3.4.1.min.4c24dfd28784ad2befb3dafaac6bf1ed4e7cd58cce713d9a0b228d426e812baf.js integrity="sha256-TCTf0oeErSvvs9r6rGvx7U581YzOcT2aCyKNQm6BK68="></script>
<script src=https://j0rd1smit.github.io/js/popper.min.549cf842cba3739e48efdb4fb6c06405d0e14a02e274538dcd9eed23f49b9e98.js integrity="sha256-VJz4Qsujc55I79tPtsBkBdDhSgLidFONzZ7tI/Sbnpg="></script>
<script src=https://j0rd1smit.github.io/js/bootstrap.min.0a34a87842c539c1f4feec56bba982fd596b73500046a6e6fe38a22260c6577b.js integrity="sha256-CjSoeELFOcH0/uxWu6mC/Vlrc1AARqbm/jiiImDGV3s="></script>
<script src=https://j0rd1smit.github.io/js/mediumish.d6fc184863fad23419eee1ce39d87152fb7f8a1c2444f5da3d16b5efa375e389.js integrity="sha256-1vwYSGP60jQZ7uHOOdhxUvt/ihwkRPXaPRa176N144k="></script></body></html>